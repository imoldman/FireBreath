#!/usr/bin/env python
# coding=utf-8
# vim: shiftwidth=4 tabstop=4 expandtab

'''本脚本用来产生boost目录下所有头文件，如果想增删头文件，请修改ALL_HEADERS列表'''

import os
import re
import shutil

# !!ALPHABETICAL ORDER!!
ALL_HEADERS = [
    (r'boost/asio/error.hpp', r'../../boost/boost/asio/error.hpp', '''
// we should use #include_next "boost/asio/error.hpp", but #include_next is only a extension in gcc
// so we have to use replative path in this #include indicator, please forgive us :-)

namespace std {
template<> struct is_error_code_enum<boost::asio::error::basic_errors> : std::true_type {};
template<> struct is_error_code_enum<boost::asio::error::netdb_errors> : std::true_type {};
template<> struct is_error_code_enum<boost::asio::error::addrinfo_errors> : std::true_type {};
template<> struct is_error_code_enum<boost::asio::error::misc_errors> : std::true_type {};
}'''),
#    (r'boost/bind.hpp', r'functional', ''),
#   # (r'boost/cast.hpp', r'cast'),
    (r'boost/chrono/duration.hpp', r'internal/chrono_wrapper.hpp', ''),
#    # (r'boost/config.hpp', r'config'),
#    (r'boost/cstdint.hpp', r'cstdint'),
    (r'boost/enable_shared_from_this.hpp', r'internal/memory_wrapper.hpp', ''),
#    # (r'boost/foreach.hpp', r'foreach'),
#    # (r'boost/format.hpp', r'format'),
#    (r'boost/function.hpp', r'functional', ''),
#    # (r'boost/function_types/is_member_function_pointer.hpp', r'type_traits'),
#    # (r'boost/integer_traits.hpp', r'integer_traits'),
    (r'boost/make_shared.hpp', r'internal/memory_wrapper.hpp', ''),
#    # (r'boost/scoped_array.hpp', r'scoped_array'),
#    # (r'boost/scoped_ptr.hpp', r'scoped_ptr'),
#    # (r'boost/shared_array.hpp', r'shared_array'),
    (r'boost/shared_ptr.hpp', r'internal/memory_wrapper.hpp', ''),
    (r'boost/smart_ptr/enable_shared_from_this.hpp', r'internal/memory_wrapper.hpp', ''),
    (r'boost/smart_ptr/make_shared.hpp', r'internal/memory_wrapper.hpp', ''),
    (r'boost/smart_ptr/bad_weak_ptr.hpp', r'internal/memory_wrapper.hpp', ''),
    (r'boost/system/error_code.hpp', r'internal/systemerror_wrapper.hpp', ''),
    (r'boost/system/system_error.hpp', r'internal/systemerror_wrapper.hpp', ''),
    (r'boost/thread.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/thread/condition_variable.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/thread/mutex.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/thread/once.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/thread/recursive_mutex.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/thread/shared_mutex.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/thread/thread.hpp', r'internal/thread_family_wrapper.hpp', ''),
    (r'boost/tuple/tuple.hpp', r'internal/tuple_wrapper.hpp', ''),
    (r'boost/tuple/tuple_comparison.hpp', r'internal/tuple_wrapper.hpp', ''),
#    (r'boost/type_traits.hpp', r'type_traits'),
#    #(r'boost/type_traits/is_arithmetic.hpp', r'is_arithmetic'),
#    #(r'boost/type_traits/is_floating_point.hpp', r'is_floating_point'),
#    #(r'boost/type_traits/is_integral.hpp', r'is_integral'),
#    #(r'boost/type_traits/is_same.hpp', r'is_same'),
#    #(r'boost/type_traits/remove_const.hpp', r'remove_const'),
#    #(r'boost/type_traits/remove_reference.hpp', r'remove_reference'),
    (r'boost/weak_ptr.hpp', r'internal/memory_wrapper.hpp', ''),
#    #(r'boost\smart_ptr\scoped_array.hpp', r'scoped_array'),
#    #(r'boost\smart_ptr\shared_array.hpp', r'shared_array'),
]

def gen_file(boost_header_path, wrapper_header_path, additional_content):
    template = '''//!
// THIS FILE IS GENERATED BY gen.py, PLEASE DONT MODIFY DIRECTLY
//
#ifndef FAKE_{header_guard}
#define FAKE_{header_guard}

#include "{wrapper_header}"  // #include <{boost_header}>
{additional_content}

#endif // #define FAKE_{header_guard}
'''
    this_dir = os.path.dirname(os.path.abspath(__file__))
    full_boost_header_path = os.path.join(this_dir, boost_header_path)
    header_directory, _ = os.path.split(full_boost_header_path)
    if not os.path.exists(header_directory):
        os.makedirs(header_directory)
    header_guard = re.sub(r'[.\\/]', '_', boost_header_path).upper()
    # full_boost_header_path = os.path.join(this_dir, r'boost/test.hpp')
    print >> open(full_boost_header_path, 'a'), \
             template.format(header_guard=header_guard,
                             wrapper_header=wrapper_header_path,
                             boost_header=boost_header_path,
                             additional_content=additional_content)

def main():
    # delete all files in boost dir
    this_dir = os.path.dirname(os.path.abspath(__file__))
    boost_dir = os.path.join(this_dir, 'boost')
    if os.path.exists(boost_dir):
        shutil.rmtree(boost_dir)
    for boost_header, wrapper_header, content in ALL_HEADERS:
        gen_file(boost_header, wrapper_header, content)

if __name__ == '__main__':
    main()

